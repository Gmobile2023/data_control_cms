<div [@routerTransition]>
    <sub-header [title]="'Quản lý báo cáo doanh thu tiêu dùng' | localize">
    </sub-header>
    <div [class]="containerClass">
        <div class="card card-custom">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-5">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <label >Mã đối soát</label>
                            </div>
                            <div class="col-md-9">
                                <input name="filterText"
                                autoFocus
                                class="form-control m-input"
                                type="text"
                                placeholder="Mã đối soát"
                                [(ngModel)]="filterText" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-5 align-items-center">
                    <div class="col-md-5">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <label for="date">Từ ngày</label>
                            </div>
                            <div class="col-md-9">
                                <p-calendar
                                    [showIcon]="true"
                                    [(ngModel)]="timeFrom"></p-calendar>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <label for="date">Đến ngày</label>
                            </div>
                            <div class="col-md-9">
                                <p-calendar
                                    [showIcon]="true"
                                    [(ngModel)]="timeTo"></p-calendar>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-1">
                        <button
                            (click)="getReportRevenue()"
                            class="btn btn-primary"
                            type="button"
                            >
                            <i class="flaticon-search-1"></i>
                        </button>
                    </div>
                </div>

                <div class="row align-items-center mt-4">
                    <div class="primeng-datatable-container">
                        <p-table [value]="listItems"
                            [tableStyle]="{ 'min-width': '50rem' }">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th rowspan="2">STT</th>
                                    <th rowspan="2">Ngày đối soát</th>
                                    <th rowspan="2">Mã đối soát</th>
                                    <th rowspan="2">Tên cấu hình</th>
                                    <th rowspan="2">Mã cấu hình</th>
                                    <th rowspan="2">Trạng thái</th>
                                    <th colspan="3" class="text-center">Báo cáo</th>
                                </tr>
                                <tr>
                                    <th>Thông tin gói cước</th>
                                    <th>Doanh thu tiêu thụ</th>
                                    <th>Dữ liệu doanh thu tiêu dùng trong kỳ</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-listItem
                                let-rowIndex="rowIndex">
                                <tr>
                                    <td>{{rowIndex + 1}}</td>
                                    <td>{{listItem.creationTime | date:'dd/MM/yyy h:mm'}}</td>
                                    <td>{{listItem.reconcileCode}}</td>
                                    <td>{{listItem.serviceName}}</td>
                                    <td>{{listItem.serviceCode}}</td>
                                    <td>
                                        {{listItem.status}}
                                        <div *ngIf="listItem.message" (click)="showDialog(listItem.message)"
                                            style="color: red; cursor: pointer;"
                                        >
                                            Xem lỗi
                                        </div>
                                    </td>
                                    <td>
                                        <!-- <a target="_blank" [href]="listItem.linkReportStatisticalPackOfData">Link</a> -->
                                        <span *ngIf="listItem.linkReportStatisticalPackOfData" class="link-file" (click)="downloadFile(listItem.serviceId, listItem.linkReportStatisticalPackOfData)">Link</span>
                                    </td>
                                    <td>
                                        <!-- <a target="_blank" [href]="listItem.linkReportRevenueControl">Link</a> -->
                                        <span *ngIf="listItem.linkReportRevenueControl" class="link-file" (click)="downloadFile(listItem.serviceId, listItem.linkReportRevenueControl)">Link</span>
                                    </td>
                                    <td>
                                        <!-- <a target="_blank" [href]="listItem.linkReportDTTD">Link</a> -->
                                        <span *ngIf="listItem.linkReportDTTD" class="link-file" (click)="downloadFile(listItem.serviceId, listItem.linkReportDTTD)">Link</span>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                        <div class="primeng-no-data text-center mt-2"
                            *ngIf="paginator.total == 0">
                            {{ 'NoData' | localize }}
                        </div>
                        <div class="mt-3" *ngIf="paginator.total > 0">
                            <p-paginator (onPageChange)="onPageChange($event)"
                                [rows]="paginator.pageSize"
                                [totalRecords]="paginator.total"
                                [rowsPerPageOptions]="[10, 20, 30]"></p-paginator>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<p-dialog
    [(visible)]="showDialogError"
    [draggable]="false" [resizable]="false"
    [style]="{width: '50%', 'margin': 'auto'}">
    <div class="custom-content">
        <h1 class="text-center">Nguyên nhân lỗi</h1>
        <div class="text-danger" [innerHtml]="messageError">
        </div>
       
        <!-- <div style="text-align: right;">
            <button
                [buttonBusy]="reReconciling"
                *ngIf="!isReReconcile && ('Pages.Administration.ReportSupplier.Reconcile' | permission)"
                class="btn btn-primary"
                (click)="reReconcile()">Đối soát lại</button>
        </div> -->
    </div>
</p-dialog>
